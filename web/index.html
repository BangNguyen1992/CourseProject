<!DOCTYPE html>
<html lang="en">

    <head>

        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="">
        <title>ImageUpload Application | Group11</title>

        <!-- Bootstrap Core CSS -->
        <link href="css/bootstrap.min.css" rel="stylesheet">

        <!-- Custom CSS -->
        <link href="css/agency.css" rel="stylesheet">
        <link href="css/lightbox.css" rel="stylesheet">

        <!-- Custom Fonts -->

        <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
        <link href='https://fonts.googleapis.com/css?family=Kaushan+Script' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Pacifico' rel='stylesheet' type='text/css'>
        

        <script type='text/javascript'>
           
        </script>

    </head>

    <body id="page-top" class="index">

        <!-- Navigation -->
        <nav class="navbar navbar-default navbar-fixed-top">
            <div class="container">
                <!-- Brand and toggle get grouped for better mobile display -->
                <div class="navbar-header page-scroll">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand page-scroll" href="#page-top">Image Upload</a>

                </div>

                <!-- Collect the nav links, forms, and other content for toggling -->
                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                    <ul class="nav navbar-nav navbar-right">

                        <li class="hidden">
                            <a href="#page-top"></a>
                        </li>

                        <li>
                            <a class="page-scroll" href="#portfolio">Gallery</a>
                        </li>

                        <li class="dropdown">
                            <a class="dropdown-toggle" data-toggle="dropdown"><b>Search</b> <span class="caret"></span></a>
                            <ul id="search-dp" class="dropdown-menu">
                                <li>
                                    <div class="row">
                                        <div class="col-md-12">
                                            <form role="search">
                                                <div class="form-group">
                                                    <input id="search" type="text" class="form-control" placeholder="Search">
                                                </div>
                                                <button id="searchSubmit" type="submit" class="btn btn-primary btn-block">Submit</button>
                                            </form>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </li>

                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown"><b>Login</b> <span class="caret"></span></a>
                            <ul id="login-dp" class="dropdown-menu">
                                <li>
                                    <div class="row">
                                        <div class="col-md-12">

                                            <form class="form" role="form" accept-charset="UTF-8" id="login-nav">
                                                <div class="form-group">

                                                    <label class="sr-only">Username</label>
                                                    <input type="text" class="form-control" id="username" placeholder="Username" required>

                                                </div>
                                                <div class="form-group">

                                                    <label class="sr-only">Password</label>
                                                    <input type="password" class="form-control" id="password" placeholder="Password" required>

                                                </div>
                                                <div class="form-group">
                                                    <button id="logincheck" type="button" class="btn btn-primary btn-block">Login</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown"><b>Register</b> <span class="caret"></span></a>
                            <ul id="login-dp" class="dropdown-menu">
                                <li>
                                    <div class="row">
                                        <div class="col-md-12">


                                            <form action="webresources/model.users/" class="form" role="form" method="post" action="login" accept-charset="UTF-8" id="login-nav" >
                                                <div class="form-group">
                                                    <label class="sr-only">Username</label>
                                                    <input type="text" name="username" class="form-control" placeholder="Username" required>
                                                </div>
                                                <div class="form-group">
                                                    <label class="sr-only">Password</label>
                                                    <input type="password" name="password" class="form-control" placeholder="Password" required>
                                                </div>
                                                <div class="form-group">
                                                    <button type="submit" class="btn btn-primary btn-block">Register</button>
                                                </div>

                                        </div>
                                        </form>
                                    </div>
                                    </div>
                                </li>
                            </ul>
                        </li>


                    </ul>
                </div>
                <!-- /.navbar-collapse -->
            </div>
            <!-- /.container-fluid -->
        </nav>

        <!-- Header -->
        <header>
            <div class="container">
                <div class="intro-text">

                    <div class="intro-heading">"YOU DON'T TAKE A PHOTOGRAPH, YOU MAKE IT!"</div>
                    <p class>-Ansel Adam-</p>
                        <form id="uploadForm" class="col-lg-12 col-md-4">
                            <div id="blankBox">
                                <input class="textInput" type="text" name="tagName" placeholder="Give your photo some tags">
                                <input class="form-control textInput" id="description" name="description" placeholder="Type some description">
                            </div>
                            <label class="label-upload btn btn-xl" for="upload">Upload</label>
                            <input type="file" id="upload" name="file">
                        </form>
                </div>
            </div>
        </header>


        <!-- Portfolio Grid Section -->
        <section id="portfolio" class="bg-light-gray">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12 text-center">
                        <h2 class="section-heading">Gallery</h2>
                        <h3 class="section-subheading text-muted" style="margin-bottom:0">-You can see what other is doing-</h3>
                        <ul id="gallery-pagination" class="pagination-sm"></ul>
                    </div>
                </div>
                <div class="gallery">    
                    <div class="row">
                        <div class="col-md-4 col-sm-6 portfolio-item" id="div1">
                            <a id="link1" href="#portfolioModal1" class="portfolio-link" data-toggle="modal" data-title="Something here" data-lightbox="Vacation">
                                <div class="portfolio-hover">
                                    <div class="portfolio-hover-content">
                                        
                                    </div>
                                </div>
                                <img id="img1" src="img/photo/a.jpg" class="img-responsive">
                            </a>
                            <div class="portfolio-caption">
                                <h4>Description</h4>
                                <p class="text-muted">Tags will be here</p>
                            </div>
                        </div>
                        <div class="col-md-4 col-sm-6 portfolio-item" id="div2">
                            <a id="link2" href="#portfolioModal2" class="portfolio-link" data-toggle="modal" data-title="Something here" data-lightbox="Vacation">
                                <div class="portfolio-hover">
                                    <div class="portfolio-hover-content">
                                        
                                    </div>
                                </div>
                                <img id="img2" src="img/photo/c.jpg" class="img-responsive">
                            </a>
                            <div class="portfolio-caption">
                                <h4>Description</h4>
                                <p class="text-muted">Tags will be here</p>
                            </div>
                        </div>
                        <div class="col-md-4 col-sm-6 portfolio-item" id="div3">
                            <a id="link3" href="#portfolioModal3" class="portfolio-link" data-toggle="modal" data-title="Something here" data-lightbox="Vacation">
                                <div class="portfolio-hover">
                                    <div class="portfolio-hover-content">
                                        
                                    </div>
                                </div>
                                <img id="img3" src="img/photo/c.jpg" class="img-responsive">
                            </a>
                            <div class="portfolio-caption">
                                <h4>Description</h4>
                                <p class="text-muted">Tags will be here</p>
                            </div>
                        </div>
                        <div class="col-md-4 col-sm-6 portfolio-item" id="div4">
                            <a id="link4" href="#portfolioModal4" class="portfolio-link" data-toggle="modal" data-title="Something here" data-lightbox="Vacation">
                                <div class="portfolio-hover">
                                    <div class="portfolio-hover-content">
                                        
                                    </div>
                                </div>
                                <img id="img4" src="img/photo/d.jpg" class="img-responsive">
                            </a>
                            <div class="portfolio-caption">
                                <h4>Description</h4>
                                <p class="text-muted">Tags will be here</p>
                            </div>
                        </div>
                        <div class="col-md-4 col-sm-6 portfolio-item" id="div5">
                            <a id="link5" href="#portfolioModal5" class="portfolio-link" data-toggle="modal" data-title="Something here" data-lightbox="Vacation">
                                <div class="portfolio-hover">
                                    <div class="portfolio-hover-content">
                                        
                                    </div>
                                </div>
                                <img id="img5" src="img/photo/h.jpg" class="img-responsive">
                            </a>
                            <div class="portfolio-caption">
                                <h4>Description</h4>
                                <p class="text-muted">Tags will be here</p>
                            </div>
                        </div>
                        <div class="col-md-4 col-sm-6 portfolio-item" id="div6">
                            <a id="link6" href="#portfolioModal6" class="portfolio-link" data-toggle="modal" data-title="Something here" data-lightbox="Vacation">
                                <div class="portfolio-hover">
                                    <div class="portfolio-hover-content">
                                        
                                    </div>
                                </div>
                                <img id="img6" src="img/photo/f.jpg" class="img-responsive">
                            </a>
                            <div class="portfolio-caption">
                                <h4>Description</h4>
                                <p class="text-muted">Tags will be here</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <footer>
            <div class="container">
                <div class="row">
                    <div class="col-md-4">
                        <span class="copyright">Copyright &copy; Project ImageUpload Service</span>
                    </div>

                    <div class="col-md-4">
                        <ul class="list-inline quicklinks">
                            <li>Chuong Truong
                            </li>
                            <li><a href="http://192.168.56.1:8080/ImgUpload5/webresources/model.image/viewgallery">Bang Nguyen</a>
                            </li>
                            <li>Mahdi Azarboon
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </footer>

        <!-- jQuery -->
        <script src="js/jquery.js"></script>
        <script src="js/jquery.twbsPagination.js"></script>
        <script src="js/jquery.twbsPagination.min.js"></script>
        <script src="js/jquery.xml2json.js"></script>        
        <script src="js/jquery.hideseek.js"></script>


        <!-- Bootstrap Core JavaScript -->
        <script src="js/bootstrap.min.js"></script>

        <!-- Plugin JavaScript -->
        <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>
        <script src="js/classie.js"></script>
        <script src="js/cbpAnimatedHeader.js"></script>

        <!-- Contact Form JavaScript -->
        <script src="js/jqBootstrapValidation.js"></script>
        <script src="js/contact_me.js"></script>

        <!-- Custom Theme JavaScript -->
        <script src="js/agency.js"></script>
        
        <!--Lightbox-->
        <script src="js/lightbox.js"></script>
        
        <script>
             var images, numOfPage,currentPage;
             var divs = ["#div1", "#div2", "#div3", "#div4", "#div5", "#div6"]; //thumbnail
             var links = ["#link1", "#link2", "#link3", "#link4", "#link5", "#link6"]; //lightbox
            function retrieveImgsByPage(curPage,images){
                
                
                if(images.length>6){
                    var start = 6*(curPage-1);
                    var end = start+6;
     
                    var images = images.slice(start,end);
                    
                        loadMore(images);
                    }else{
                       
                        loadMore(images);
                    }
                    if(images.length!==0){

                        if(images.length<6){
                            for(var i=images.length;i<6;i++){
                                $(divs[i]).hide();
                            }

                        }else{
                            for(var i=0;i<6;i++){
                                $(divs[i]).show();
                            }
                        }
                    }
                   
                }
                
                function loadMore(list){
                    var k=0, a=0, l=0;
                    console.log(list);
                    list.forEach(function(img){
                        var desc = img.description;
                        var path = "http://192.168.56.1/test/" + img.path;
     
                        $(divs[a++]+" h4").text(desc);
                        $(links[k++]+" img").attr('src', path);
                        $(divs[l++]+" a").attr('href', path).attr('data-title', path);
                    });
                    
                }
                function findNumOfPage(images){
                    var result=0;
                    for(i in images){
                        result++;
                    }
                    return Math.ceil(result/6);
                }

            $(document).ready(function () {
           
                $.ajax({
                    url: 'webresources/model.image/viewgallery',
                    type: 'GET',
                    dataType: 'xml',
                    cache: false,
                    success: function (returnedXMLResponse) {
                        imgs = ["#img1", "#img2", "#img3", "#img4", "#img5", "#img6"];
                        images = $.xml2json(returnedXMLResponse).image;
                        console.log(images);
                        numOfPage = findNumOfPage(images);
                        retrieveImgsByPage(0,images);
                        $("#gallery-pagination").twbsPagination({
                            totalPages: numOfPage,
                            visiblePages: 3,
                            hrefVariable: '{{pageNumber}}',
                            onPageClick: function (event, page) {
                                retrieveImgsByPage(page,images);
                            }
                        });
                    },
                    error: function (data) {
                        console.log("err", data);
                    }
                });
                $('#upload').on('change', function () {
                    $(this).closest('form').trigger('submit');
                });
                //Program a custom submit function for the form

                $("#uploadForm").submit(function (event) {
                    //disable the default form submission
                    event.preventDefault();
                    console.log("in");
                    //grab all form data  
                    var formData = new FormData($(this)[0]);

                    $.ajax({
                        url: 'Push',
                        type: 'POST',
                        data: formData,
                        async: false,
                        cache: false,
                        contentType: false,
                        processData: false,
                        success: function (data) {
                            alert("File uploaded successfully!");
                            location.reload();
                        },
                        error: function (data) {
                            alert("File failed to upload!");
                        }
                    });
                    

                    return false;
                });
                
                

            });
        </script>
        <script>
            function userLogin(username, password) {
                $.ajax({
                    type: "GET",
                    url: "http://192.168.56.1:8080/ImgUpload5/webresources/model.users/userLogin/" + username + "/" + password,
                    dataType: "text",
                    success: function (response) {
                        if (response === "false") {
                            alert("uname or pass wrong");
                        }
                        else {
                            alert("User: " + username + " has logged in.");
                            localStorage.setItem('loggedin', true);
                            localStorage.setItem('user', response);
                             }
                    }
                });
            }

            $('#logincheck').click(function () {
                username = $("#username").val();
                password = $("#password").val();
                userLogin(username, password);

                logged = true;
            });
            
            $("#searchSubmit").click(function(event){
                event.preventDefault(); //
                var search = $("#search").val();
                $.ajax({
                    type: "GET",
                    url: "http://192.168.56.1:8080/ImgUpload5/webresources/model.image/findImageByTitle/" + search,
                    dataType: 'xml',
                    success: function (response) {
                        var searchResult = $.xml2json(response).image;
                        console.log(searchResult);
                        if(searchResult){
                            numOfPage = findNumOfPage(searchResult);
                            retrieveImgsByPage(0,searchResult);
                        $("#gallery-pagination").twbsPagination({
                            totalPages: numOfPage,
                            visiblePages: 3,
                            hrefVariable: '{{pageNumber}}',
                            onPageClick: function (event, page) {
                                retrieveImgsByPage(page,searchResult);
                            }
                        });
                        }else{
                            alert("Image not found");
                        }
                        
                    },
                    error: function(res){
                        console.log(res);
                    }
                });                
            });
            
                    </script>
    </body>

</html>
